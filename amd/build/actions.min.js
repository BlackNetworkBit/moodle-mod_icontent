define(["jquery","jqueryui"],function(a,b){function c(){if(!a("#idcommentnote").val().trim())return a("#idcommentnote").focus().val(""),!1;var b=a(this),c={action:"savereturnpagenotes",id:a(this).attr("data-cmid"),pageid:a(this).attr("data-pageid"),sesskey:a(this).attr("data-sesskey"),comment:a("#idcommentnote").val(),tab:"note","private":a("#idprivate").is(":checked")?1:0,featured:a("#idfeatured").is(":checked")?1:0,doubttutor:0};e(b),c="&"+a.param(c),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:c,success:function(c){a("#idpagenotesnote").html(c.notes),a("#idcommentnote").val(""),a("#messagenotes").text(c.totalnotes),f(b)}})}function d(){if(!a("#idcommentdoubt").val().trim())return a("#idcommentdoubt").focus().val(""),!1;var b=a(this),c={action:"savereturnpagenotes",id:a(this).attr("data-cmid"),pageid:a(this).attr("data-pageid"),sesskey:a(this).attr("data-sesskey"),comment:a("#idcommentdoubt").val(),tab:"doubt",doubttutor:a("#iddoubttutor").is(":checked")?1:0,"private":0,featured:0};e(b),c="&"+a.param(c),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:c,success:function(c){a("#idpagenotesdoubt").html(c.notes),a("#idcommentdoubt").val(""),a("#messagedoubt").text(c.totalnotes),f(b)}})}function e(b){b.hide(),a(".icontent-page").children(".fulltextpage").prepend(a("<div />").addClass("loading").html('<img src="pix/loading.gif" alt="Loading" class="img-loading" />')).css("opacity","0.5")}function f(b){b.show(),a(".icontent-page").children(".fulltextpage").css("opacity","1").children(".loading").remove(),b.removeAttr("disabled")}function g(){var b=a(this).children("span"),c={action:"likenote",id:a(this).attr("data-cmid"),pagenoteid:a(this).attr("data-pagenoteid"),sesskey:a(this).attr("data-sesskey")};c="&"+a.param(c),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:c,success:function(a){b.text(a.likes)}})}function h(b){var c=b.data.lastcomment,d=a(this).parent(".buttonscomment").parent(".notecomment");d.text(c)}function i(){var b=a(this).parent(".buttonscomment").parent(".notecomment"),c=b.children(".textnotecomment").val();if(!c.trim())return b.children(".textnotecomment").focus().val(""),!1;var d={action:"editnote",id:b.attr("data-cmid"),pagenoteid:b.attr("data-pagenoteid"),sesskey:b.attr("data-sesskey"),comment:c};d="&"+a.param(d),a(this).prop("disabled",!0),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:d,success:function(a){b.text(a.comment)}})}function j(){var b=a(this).parent(".notefooter").parent(".noterowicontent").children(".notecomment"),c=b.text();b.text("").append(a("<textarea />").addClass("textnotecomment span11").text(c)).append(a("<div />").addClass("buttonscomment").append(a("<button />").addClass("btnnotesave").html('<i class="fa fa-floppy-o"></i>')).append(a("<button />").addClass("btnnotecancel").html('<i class="fa fa-times"></i>'))),a(".textnotecomment").focus(),a(".btnnotecancel").click({lastcomment:c},h),a(".btnnotesave").click(i)}function k(){var b=a(this).parent(".buttonscomment").parent(".notecomment");b.children(".replynotecomment").remove(),a(this).parent(".buttonscomment").remove()}function l(){var b=a(this).parent(".buttonscomment").parent(".notecomment"),c=b.children(".replynotecomment").val();if(!c.trim())return b.children(".replynotecomment").focus().val(""),!1;var d={action:"replynote",id:b.attr("data-cmid"),parent:b.attr("data-pagenoteid"),sesskey:b.attr("data-sesskey"),comment:c};d="&"+a.param(d),a(this).prop("disabled",!0),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:d,success:function(c){a("#message"+c.tab).text(c.totalnotes),a("#pnote"+parseInt(c.parent)).after(c.reply),b.children(".replynotecomment").remove(),b.children(".buttonscomment").remove()}})}function m(){var b=a(this).parent(".notefooter").parent(".noterowicontent").children(".notecomment");b.children(".replynotecomment").length||(a(".replynotecomment").remove(),a(".buttonscomment").remove(),b.append(a("<textarea />").addClass("replynotecomment span").attr("required","required").attr("maxlength",1024)).append(a("<div />").addClass("buttonscomment").append(a("<button />").addClass("btnnotereplysave").html('<i class="fa fa-floppy-o"></i>')).append(a("<button />").addClass("btnnotereplycancel").html('<i class="fa fa-times"></i>')))),a(".replynotecomment").focus(),a(".btnnotereplycancel").click(k),a(".btnnotereplysave").click(l)}function n(){}function o(){var b=a(this).serialize(),c=parseInt(a("#idhfieldcmid").val()),d=a("#idhfieldsesskey").val(),e={action:"saveattempt",id:c,sesskey:d,formdata:b};return a(".btn-sendanswers").prop("disabled",!0),a.ajax({type:"POST",dataType:"json",url:"ajax.php",data:e,success:function(b){a("#idquestionsarea").html(b.grid)}}),!1}function p(b){var c=b.data.idtogle,d={};a(c).toggle("fade",d,500),a(this).toggleClass("closed",500),a(this).hasClass("closed")?a(this).children("i").removeClass("fa-caret-down").addClass("fa-caret-right"):a(this).children("i").removeClass("fa-caret-right").addClass("fa-caret-down")}function q(){a(this).hide(),a(".suspension-points").hide(),a(".read-more-target").show("fade"),a(".read-more-state-off").show()}function r(){a(this).hide(),a(".read-more-target").hide("fade"),a(".suspension-points").show(),a(".read-more-state-on").show()}return{init:function(){a("#idicontentpages").on("click","#idbtnsavenote",c),a("#idicontentpages").on("click","#idbtnsavedoubt",d),a("#idicontentpages").on("click","#idtitlenotes",{idtogle:"#idfulltab"},p),a("#idicontentpages").on("click","#idtitlequestionsarea",{idtogle:"#idcontentquestionsarea"},p),a("#idicontentpages").on("click",".read-more-state-on",q),a("#idicontentpages").on("click",".read-more-state-off",r),a("#idicontentpages").on("click",".likenote",g),a("#idicontentpages").on("click",".editnote",j),a("#idicontentpages").on("click",".replynote",m),a("#idicontentpages").on("click",".togglehighcontrast",n),a("#idicontentpages").on("submit","#idformquestions",o)}}});